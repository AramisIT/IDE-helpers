use master;

ALTER DATABASE [{0}] SET SINGLE_USER WITH ROLLBACK IMMEDIATE 

ALTER DATABASE [{0}] SET SINGLE_USER WITH NO_WAIT

ALTER DATABASE [{0}] SET MULTI_USER WITH ROLLBACK IMMEDIATE; 

WAITFOR DELAY '00:00:01'

GO

ALTER DATABASE [{0}] SET SINGLE_USER WITH ROLLBACK IMMEDIATE 

ALTER DATABASE [{0}] SET SINGLE_USER WITH NO_WAIT

ALTER DATABASE [{0}] SET MULTI_USER WITH ROLLBACK IMMEDIATE; 

print 'restoring'

RESTORE DATABASE [{0}]
   FROM DISK = '{1}'

GO

USE [{0}]

GO

IF  EXISTS (SELECT * FROM sys.database_principals WHERE name = N'{2}')
DROP USER [{2}]
GO
CREATE USER [{2}] FOR LOGIN [{2}]
GO
EXEC sp_addrolemember N'db_owner', N'{2}'
GO

IF  EXISTS (SELECT * FROM sys.database_principals WHERE name = N'AramisGuest')
DROP USER [AramisGuest]
GO
CREATE USER [AramisGuest] FOR LOGIN [AramisGuest]
GO

EXEC sp_addrolemember N'db_owner', N'AramisGuest'
GO

print ' '

print 'Database "{0}" was successfully restored !'